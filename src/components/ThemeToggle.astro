---
import { Icon } from "astro-icon/components";
---

<!-- Botón para cambiar tema -->
<button id="theme-toggle" class="cursor-pointer backdrop-blur-md sm:bg-opacity-10 rounded-full">
  <Icon name="nav/sun" class="icon-sun hidden dark:text-yellow-200 size-7" />
  <Icon name="nav/moon" class="icon-moon hidden text-dark size-7" />
</button>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById("theme-toggle");
    if (!(toggleBtn instanceof HTMLElement)) return;

    const iconSun = toggleBtn.querySelector(".icon-sun") as HTMLElement;
    const iconMoon = toggleBtn.querySelector(".icon-moon") as HTMLElement;

    // Función para mostrar el ícono correcto
    function updateIcons(isDark: boolean) {
      if (isDark) {
        iconSun.classList.remove("hidden");
        iconMoon.classList.add("hidden");
      } else {
        iconSun.classList.add("hidden");
        iconMoon.classList.remove("hidden");
      }
    }

    // Tema inicial
    const prefersDark =
      localStorage.getItem("theme") === "dark" ||
      (!localStorage.getItem("theme") &&
        window.matchMedia("(prefers-color-scheme: dark)").matches);

    document.documentElement.classList.toggle("dark", prefersDark);
    updateIcons(prefersDark);

    // Al hacer click: cambiar tema y actualizar íconos
    toggleBtn.addEventListener("click", () => {
      const isDark: boolean = document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      updateIcons(isDark);
    });
  });
</script>
